...
(earlier output truncated, 2 bytes)

 @google/gemini-cli@0.21.0-nightly.20251209.ec9a8c7a7 test
> vitest run pause.test


 RUN  v3.2.4 /Users/bill/projects/gemini-cli/packages/cli
      Coverage enabled with v8

 ‚ùØ src/ui/components/InputPrompt.pause.test.tsx (31 tests | 4 failed) 14ms
   ‚úì InputPrompt - Auto-Pause Functionality > Text Input Keys > should auto-pause when typing "a" during tool chain 2ms
   ‚úì InputPrompt - Auto-Pause Functionality > Text Input Keys > should auto-pause when typing "1" during tool chain 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Text Input Keys > should auto-pause when typing space during tool chain 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Text Input Keys > should auto-pause when typing special characters during tool chain 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Text Input Keys > should auto-pause for all printable single characters 1ms
   ‚úì InputPrompt - Auto-Pause Functionality > Navigation Keys > should NOT auto-pause for arrow up 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Navigation Keys > should NOT auto-pause for arrow down 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Navigation Keys > should NOT auto-pause for arrow left 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Navigation Keys > should NOT auto-pause for arrow right 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Navigation Keys > should NOT auto-pause for pageup 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Navigation Keys > should NOT auto-pause for pagedown 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Special Keys > should NOT auto-pause for return/enter 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Special Keys > should NOT auto-pause for escape 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Special Keys > should NOT auto-pause for tab 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Special Keys > should NOT auto-pause for delete 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Special Keys > should NOT auto-pause for backspace 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Modifier Keys > should NOT auto-pause for Ctrl+c 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Modifier Keys > should NOT auto-pause for Meta+a (Cmd+a) 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Modifier Keys > should NOT auto-pause for Shift+a (capital A) 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Modifier Keys > should NOT auto-pause for any Ctrl combination 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Context Requirements > should NOT auto-pause when not in tool chain 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Context Requirements > should NOT auto-pause when already paused 0ms
   √ó InputPrompt - Auto-Pause Functionality > Context Requirements > should NOT auto-pause in Idle state 6ms
     ‚Üí expected true to be false // Object.is equality
   √ó InputPrompt - Auto-Pause Functionality > Context Requirements > should NOT auto-pause in WaitingForConfirmation state 0ms
     ‚Üí expected true to be false // Object.is equality
   √ó InputPrompt - Auto-Pause Functionality > Context Requirements > should only auto-pause in Responding state during tool chain 1ms
     ‚Üí expected true to be false // Object.is equality
   ‚úì InputPrompt - Auto-Pause Functionality > Edge Cases > should NOT auto-pause for multi-character sequences 0ms
   √ó InputPrompt - Auto-Pause Functionality > Edge Cases > should auto-pause for emoji (single character in JS) 0ms
     ‚Üí expected false to be true // Object.is equality
   ‚úì InputPrompt - Auto-Pause Functionality > Edge Cases > should handle space key correctly 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Auto-Unpause on Submit > should unpause when submitting message while paused 1ms
   ‚úì InputPrompt - Auto-Pause Functionality > Auto-Unpause on Submit > should NOT unpause when submitting and not paused 0ms
   ‚úì InputPrompt - Auto-Pause Functionality > Auto-Unpause on Submit > should NOT unpause when submitting outside tool chain 0ms
 ‚ùØ src/ui/components/LoadingIndicator.pause.test.tsx (10 tests | 2 failed) 73ms
   ‚úì <LoadingIndicator /> - Pause Display > should render prominent pause indicator when streamingState is Paused 20ms
   ‚úì <LoadingIndicator /> - Pause Display > should show help text for unpausing 1ms
   ‚úì <LoadingIndicator /> - Pause Display > should not show regular loading content when paused 1ms
   √ó <LoadingIndicator /> - Pause Display > should transition from Responding to Paused correctly 27ms
     ‚Üí expected '\n  ERROR  Text string "MockSpinner" ‚Ä¶' to contain 'Loading...'
   √ó <LoadingIndicator /> - Pause Display > should transition from Paused back to Responding correctly 14ms
     ‚Üí expected '\n  ERROR  Text string "MockSpinner" ‚Ä¶' to contain 'Loading...'
   ‚úì <LoadingIndicator /> - Pause Display > should render pause indicator on narrow terminals 1ms
   ‚úì <LoadingIndicator /> - Pause Display > should render pause indicator on wide terminals 1ms
   ‚úì <LoadingIndicator /> - Pause Display > should ignore rightContent when paused 1ms
   ‚úì <LoadingIndicator /> - Pause Display > should ignore thought when paused 1ms
   ‚úì <LoadingIndicator /> - Pause Display > should prioritize pause state over all other states 5ms
 ‚ùØ src/ui/hooks/useGeminiStream.pause.test.tsx (7 tests | 7 failed) 113ms
   √ó useGeminiStream - Pause/Unpause > should initialize with isPaused = false and streamingState = Idle 36ms
     ‚Üí Cannot read properties of undefined (reading 'streamingState')
   √ó useGeminiStream - Pause/Unpause > should report isInToolCallChain = true when tool is executing 14ms
     ‚Üí Cannot read properties of undefined (reading 'isInToolCallChain')
   √ó useGeminiStream - Pause/Unpause > should allow pausing during tool call chain 16ms
     ‚Üí Cannot read properties of undefined (reading 'streamingState')
   √ó useGeminiStream - Pause/Unpause > should not allow pausing when not in tool call chain 13ms
     ‚Üí Cannot read properties of undefined (reading 'streamingState')
   √ó useGeminiStream - Pause/Unpause > should auto-unpause when tool call chain completes 12ms
     ‚Üí act is not a function
   √ó useGeminiStream - Pause/Unpause > should allow unpausing via togglePause 13ms
     ‚Üí act is not a function
   √ó useGeminiStream - Pause/Unpause > should allow manual unpausing via setIsPaused 9ms
     ‚Üí act is not a function

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Suites 1 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  src/ui/AppContainer.pause.test.tsx [ src/ui/AppContainer.pause.test.tsx ]
Error: Cannot find module '../types.js' imported from '/Users/bill/projects/gemini-cli/packages/cli/src/ui/AppContainer.pause.test.tsx'
 ‚ùØ src/ui/AppContainer.pause.test.tsx:8:1
      6| 

      7| import { describe, it, expect, vi } from 'vitest';
 Test Files  4 failed (4)
      Tests  13 failed | 35 passed (48)
   Start at  14:59:09
      8| import { StreamingState } from '../types.js';
       | ^
      9| import type { Key } from '../hooks/useKeypress.js';
     10| 

Caused by: Error: Failed to load url ../types.js (resolved id: ../types.js) in /Users/bill/projects/gemini-cli/packages/cli/src/ui/AppContainer.pause.test.tsx. Does the file exist?
 ‚ùØ loadAndTransform ../../node_modules/vite/dist/node/chunks/config.js:23280:33

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/14]‚éØ
   Duration  3.18s (transform 685ms, setup 93ms, collect 3.83s, tests 200ms, environment 1ms, prepare 244ms)



JUNIT report written to /Users/bill/projects/gemini-cli/packages/cli/junit.xml
‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 13 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ

 FAIL  src/ui/components/InputPrompt.pause.test.tsx > InputPrompt - Auto-Pause Functionality > Context Requirements > should NOT auto-pause in Idle state
AssertionError: expected true to be false // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

 ‚ùØ src/ui/components/InputPrompt.pause.test.tsx:203:63
    201|     it('should NOT auto-pause in Idle state', () => {
    202|       const key = createKey('a', { sequence: 'a' });
    203|       expect(shouldAutoPause(key, true, StreamingState.Idle)).toBe(fal‚Ä¶
       |                                                               ^
    204|     });
    205| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/14]‚éØ

 FAIL  src/ui/components/InputPrompt.pause.test.tsx > InputPrompt - Auto-Pause Functionality > Context Requirements > should NOT auto-pause in WaitingForConfirmation state
AssertionError: expected true to be false // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

 ‚ùØ src/ui/components/InputPrompt.pause.test.tsx:208:81
    206|     it('should NOT auto-pause in WaitingForConfirmation state', () => {
    207|       const key = createKey('a', { sequence: 'a' });
    208|       expect(shouldAutoPause(key, true, StreamingState.WaitingForConfi‚Ä¶
       |                                                                                 ^
    209|         false,
    210|       );

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/14]‚éØ

 FAIL  src/ui/components/InputPrompt.pause.test.tsx > InputPrompt - Auto-Pause Functionality > Context Requirements > should only auto-pause in Responding state during tool chain
AssertionError: expected true to be false // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

 ‚ùØ src/ui/components/InputPrompt.pause.test.tsx:221:63
    219|       // Missing any condition should return false
    220|       expect(shouldAutoPause(key, false, StreamingState.Responding)).t‚Ä¶
    221|       expect(shouldAutoPause(key, true, StreamingState.Idle)).toBe(fal‚Ä¶
       |                                                               ^
    222|       expect(shouldAutoPause(key, true, StreamingState.Paused)).toBe(f‚Ä¶
    223|     });

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/14]‚éØ

 FAIL  src/ui/components/InputPrompt.pause.test.tsx > InputPrompt - Auto-Pause Functionality > Edge Cases > should auto-pause for emoji (single character in JS)
AssertionError: expected false to be true // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

 ‚ùØ src/ui/components/InputPrompt.pause.test.tsx:234:69
    232|     it('should auto-pause for emoji (single character in JS)', () => {
    233|       const key = createKey('üòÄ', { sequence: 'üòÄ' });
    234|       expect(shouldAutoPause(key, true, StreamingState.Responding)).to‚Ä¶
       |                                                                     ^
    235|     });
    236| 

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/14]‚éØ

 FAIL  src/ui/components/LoadingIndicator.pause.test.tsx > <LoadingIndicator /> - Pause Display > should transition from Responding to Paused correctly
AssertionError: expected '\n  ERROR  Text string "MockSpinner" ‚Ä¶' to contain 'Loading...'

[32m- Expected[39m
[31m+ Received[39m

[32m- Loading...[39m
[31m+[39m
[31m+   ERROR  Text string "MockSpinner" must be rendered inside <Text> component[39m
[31m+[39m
[31m+  file:///Users/bill/projects/gemini-cli/node_modules/ink/src/reconciler.ts:220:10[39m
[31m+[39m
[31m+  -createTextInstance[39m
[31m+                     (file:///Users/bill/projects/gemini-cli/node_modules/ink/src/reconciler.ts:220:[39m
[31m+                     10)[39m
[31m+  -completeWor[39m
[31m+              (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconciler.de[39m
[31m+              velopment.js:9082:42)[39m
[31m+  -runWithFiberIn[39m
[31m+   EV            (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconciler[39m
[31m+                 .development.js:1738:13)[39m
[31m+  -completeUnitOfW[39m
[31m+   rk             (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconcile[39m
[31m+                  r.development.js:12962:19)[39m
[31m+  -performUnitOfW[39m
[31m+   rk            (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconciler[39m
[31m+                 .development.js:12843:11)[39m
[31m+  -workLoopSyn[39m
[31m+              (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconciler.de[39m
[31m+              velopment.js:12644:41)[39m
[31m+  -renderRootSy[39m
[31m+   c           (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconciler.d[39m
[31m+               evelopment.js:12624:11)[39m
[31m+  -performWorkOnR[39m
[31m+   ot            (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconciler[39m
[31m+                 .development.js:12135:44)[39m
[31m+  -performSyncWorkOn[39m
[31m+   oot              (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconci[39m
[31m+                    ler.development.js:2446:7)[39m
[31m+  -flushSyncWorkAcrossRoo[39m
[31m+   s_impl                (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-re[39m
[31m+                         conciler.development.js:2294:21)[39m
[31m+[39m

 ‚ùØ src/ui/components/LoadingIndicator.pause.test.tsx:92:20
     90|     // Initially Responding
     91|     let output = lastFrame();
     92|     expect(output).toContain('Loading...');
       |                    ^
     93|     expect(output).not.toContain('PAUSED');
     94|     

‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/14]‚éØ

 FAIL  src/ui/components/LoadingIndicator.pause.test.tsx > <LoadingIndicator /> - Pause Display > should transition from Paused back to Responding correctly
AssertionError: expected '\n  ERROR  Text string "MockSpinner" ‚Ä¶' to contain 'Loading...'

[32m- Expected[39m
[31m+ Received[39m

[32m- Loading...[39m
[31m+[39m
[31m+   ERROR  Text string "MockSpinner" must be rendered inside <Text> component[39m
[31m+[39m
[31m+  file:///Users/bill/projects/gemini-cli/node_modules/ink/src/reconciler.ts:220:10[39m
[31m+[39m
[31m+  - createTextInstance (file:///Users/bill/projects/gemini-cli/node_modules/ink/src/reconciler.ts:220:10)[39m
[31m+  -completeWork[39m
[31m+               (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconciler.development.js:9082:4[39m
[31m+               2)[39m
[31m+  -runWithFiberInDE[39m
[31m+                   (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconciler.development.js:17[39m
[31m+                   38:13)[39m
[31m+  -completeUnitOfWor[39m
[31m+                    (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconciler.development.js:1[39m
[31m+                    2962:19)[39m
[31m+  -performUnitOfWor[39m
[31m+                   (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconciler.development.js:12[39m
[31m+                   843:11)[39m
[31m+  -workLoopSync[39m
[31m+               (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconciler.development.js:12644:[39m
[31m+               41)[39m
[31m+  -renderRootSync[39m
[31m+                 (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconciler.development.js:1262[39m
[31m+                 4:11)[39m
[31m+  -performWorkOnRoo[39m
[31m+                   (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconciler.development.js:12[39m
[31m+                   135:44)[39m
[31m+  -performSyncWorkOnRo[39m
[31m+   t                  (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconciler.development.js[39m
[31m+                      :2446:7)[39m
[31m+  -flushSyncWorkAcrossRoots_[39m
[31m+   mpl                      (/Users/bill/projects/gemini-cli/node_modules/react-reconciler/cjs/react-reconciler.developm[39m
[31m+                            ent.js:2294:21)[39m
[31m+[39m

 ‚ùØ src/ui/components/LoadingIndicator.pause.test.tsx:125:20
    123|     
    124|     output = lastFrame();
    125|     expect(output).toContain('Loading...');
       |                    ^
    126|     expect(output).not.toContain('PAUSED');
